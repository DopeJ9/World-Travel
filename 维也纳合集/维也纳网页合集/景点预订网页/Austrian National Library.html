<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Austrian National Library | Tickets & Booking</title>
<meta name="description" content="Austrian National Library ticket booking: opening hours, August 2026 calendar, time slots, prices, and tour guide options.">
<style>
/* Reset */
* { box-sizing: border-box; }
html, body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; color: var(--ink); background: var(--sand); }
a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap');

/* Theme */
:root { --brand:#e8613f; --brand-dark:#c54f33; --accent:#3f6b6e; --mint:#d8e6e7; --sand:#f3f7f7; --ink:#102326; --sky:#e9f1f2; --lav:#e9f1f2; --leaf:#d8e6e7; }

/* Layout */
header { position: sticky; top: 0; z-index: 10; background: rgba(243,247,247,.9); backdrop-filter: saturate(180%) blur(8px); border-bottom: 1px solid #e2e8ea; }
.container { max-width: 1120px; padding: 0 16px; margin: 0 auto; }
.nav { display: flex; align-items: center; justify-content: space-between; height: 56px; }
.brand { font-weight: 700; letter-spacing: .3px; }
.nav a { margin-left: 16px; font-weight: 500; }

/* Compact block spacing */
main section { padding: 28px 0; border-bottom: 1px solid #e2e8ea; }
section h2 { margin: 0 0 8px; font-size: 24px; }
section p { line-height: 1.75; margin: 0 0 12px; }

.section-alt { background: var(--sand); border-top: 1px solid #f0ece3; border-bottom: 1px solid #f0ece3; }
.section-accent { background: linear-gradient(180deg, #fff 0%, var(--leaf) 100%); }
.heading-accent { display: inline-flex; align-items: center; gap: 12px; font-family: 'Playfair Display', Georgia, serif; letter-spacing: .3px; }
.heading-accent::before { content:""; display:inline-block; width: 36px; height: 10px; border-radius: 6px; background: linear-gradient(90deg, #c58f1b 0%, #f1d18a 100%); box-shadow: 0 2px 8px rgba(197,143,27,.35); }
.heading-accent.center { justify-content: center; width: 100%; }
.subheading { font-size: 18px; font-weight: 700; color: #244b6b; margin: 0 0 12px; letter-spacing: .2px; }
.section-title { display:flex; align-items:center; gap:10px; font-weight:800; color: var(--accent); }
.section-title .dot { width:12px; height:12px; background:var(--accent); border-radius:50%; display:inline-block; box-shadow: 0 0 0 3px var(--mint) inset; }
.section-card { border:1px solid #e2e8ea; border-radius:14px; background:#fff; box-shadow: 0 10px 18px rgba(63,107,110,.06); padding: 16px; }
.section-card.fill { display:flex; flex-direction: column; height: 100%; }
/* Divider below panel header */
.panel-divider { height: 0; border: 0; border-top: 1px solid #edf0f3; margin: 8px 0 12px; }

.grid { display: grid; grid-template-columns: repeat(12, 1fr); grid-gap: 16px; }
.col-6 { grid-column: span 6; }
.col-7 { grid-column: span 7; }
.col-5 { grid-column: span 5; }
.col-12 { grid-column: span 12; }

@media (max-width: 768px) {
	.nav a { margin-left: 12px; }
	.grid { grid-template-columns: repeat(6, 1fr); }
	.col-6 { grid-column: span 6; }
	.col-7 { grid-column: span 6; }
	.col-5 { grid-column: span 6; }
}

/* Cards & media */
.card { border: 1px solid #e2e8ea; border-radius: 10px; overflow: hidden; background: #fff; box-shadow: 0 1px 2px rgba(63,107,110,.06); }
.card .body { padding: 16px; }
img.responsive { display: block; width: 100%; height: auto; }
.card.accent { border-color: var(--sky); background: #fff; box-shadow: 0 6px 16px rgba(10,102,194,.08); }
.badge { display: inline-block; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; color: #fff; background: var(--brand); }
.badge.alt { background: var(--accent); }

/* Cover (full-bleed, keep aspect ratio) */
.cover { position: relative; border-bottom: 1px solid #e2e8ea; min-height: 160px; max-height: 30vh; overflow: hidden; }
.cover-inner { position: static; }
.cover .container { max-width: 100%; padding: 0; }
.cover img { width: 100%; height: 100%; display: block; object-fit: cover; object-position: center 60%; }
.cover .overlay { position: absolute; inset: 0; z-index: 1; background: linear-gradient(180deg, rgba(16,20,24,.15) 0%, rgba(10,102,194,.35) 70%, rgba(0,0,0,.45) 100%); display: flex; align-items: center; justify-content: center; text-align: center; }
.hero .content, .cover .content { color: #fff; padding: 12px 16px; width: 100%; max-width: 900px; margin: 0 auto; }
.hero .title, .cover .title { font-size: 34px; margin: 0 0 6px; font-family: Georgia, "Times New Roman", serif; letter-spacing: .5px; text-shadow: 0 2px 4px rgba(0,0,0,.5), 0 8px 24px rgba(0,0,0,.35); }
.hero .subtitle, .cover .subtitle { font-size: 16px; opacity: .95; margin: 0; text-shadow: 0 1px 2px rgba(0,0,0,.45); }

/* Footer */
footer { color: #666; padding: 24px 0; }

/* Final bottom summary */
.final-summary { padding: 20px 0 28px; background: #f8fafc; border-top: 1px solid #edf0f3; }
.final-summary .final-dt { text-align: center; color: #5b6b7a; margin-bottom: 8px; font-weight: 600; }
.final-summary .final-dt .sep { margin: 0 8px; color: #9aa6b2; }
.final-summary .final-divider { border-top: 1px solid #e6e9ee; margin: 8px 0 12px; }
.success-banner { display:none; margin: 10px auto 0; max-width: 760px; text-align:center; background:var(--leaf); border:1px solid #cfe0e2; color:#1f4e52; padding: 12px 14px; border-radius: 12px; font-weight: 800; }
.final-summary .final-list { max-width: 760px; margin: 0 auto 10px; display: grid; gap: 8px; color: #2b3a4a; }
.final-summary .final-item { display:flex; align-items:center; justify-content:space-between; padding: 8px 10px; background:#fff; border:1px solid #edf0f3; border-radius:10px; }
.final-summary .final-item .label { font-weight: 700; }
.final-summary .final-item .value { font-weight: 800; color: #22313f; }
.total-banner { background: #22313f; color:#fff; font-weight:800; text-align:center; border-radius: 16px; padding: 16px; font-size: 20px; }
.final-cta { display:block; margin: 12px auto 0; background:#22313f; color:#fff; font-weight:800; border:0; border-radius:28px; padding: 12px 28px; box-shadow: 0 8px 22px rgba(34,49,63,.25); letter-spacing:.5px; }
.final-cta:disabled { filter: grayscale(1); opacity: .6; cursor: not-allowed; }
/* Simple modal */
/* (modal styles removed on revert) */

/* Utility */
.muted { color: #666; }
.btn { display: inline-block; padding: 10px 14px; border-radius: 8px; background: var(--brand); color: #fff; font-weight: 600; }
.btn:hover { filter: brightness(.95); text-decoration: none; }
.btn.alt { background: var(--accent); }
.pill-info { display:inline-flex; gap:8px; align-items:center; padding:8px 12px; background: var(--sky); border:1px solid #d9eaff; border-radius: 999px; }
/* Section notice */
.section-note { display:flex; align-items:center; justify-content:center; gap:10px; padding:10px 12px; background: var(--sky); border:1px solid #d9eaff; border-radius:12px; color:#244b6b; font-weight:700; margin: 8px 0 16px; }
.section-note.small { font-weight:600; padding:8px 10px; margin:6px 0 10px; }
.info-ic { width:18px; height:18px; border-radius:999px; border:1px solid #d9eaff; background: var(--sky); color: var(--brand); display:inline-flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; line-height:1; }
.info-ic.lg { width:22px; height:22px; font-size:14px; }

/* Hours redesign */
.hours-card { background: linear-gradient(180deg, #fafcfe 0%, #f3f7fb 100%); border:1px solid #e3ecf7; border-radius:14px; padding:16px; box-shadow: 0 8px 18px rgba(10,102,194,.06); }
.hours-list { list-style:none; padding:0; margin:0; }
.hours-list li { display:flex; justify-content:space-between; padding:10px 12px; border-bottom: 1px dashed #e3e8ef; }
.hours-list li:last-child { border-bottom:0; }
.hours-em { background:#ffe9e6; color:#9a1f0e; border:1px solid #ffd2c9; padding:2px 8px; border-radius:999px; font-weight:800; font-size:12px; }
.hours-note { font-size:13px; color:#5b6b7a; margin-top:8px; }
.address-card { background: linear-gradient(180deg, #fffdf7 0%, #fbf4e6 100%); border:1px solid #f0e1be; border-radius:14px; padding:16px; }
/* Horizontal hours blocks */
.hours-flex { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px; }
.hour-box { padding:14px; border-radius:12px; border:1px solid #e3ecf7; background: linear-gradient(180deg, #f7fbff 0%, #edf5ff 100%); box-shadow: 0 6px 14px rgba(10,102,194,.06); }
.hour-box h4 { margin:0 0 6px; font-size:14px; color:#244b6b; text-transform: uppercase; letter-spacing:.4px; }
.hour-box p { margin:0; font-weight:700; }
.hour-box.em { background: linear-gradient(180deg, #fff0ec 0%, #ffe2db 100%); border-color:#ffd2c9; }
.hour-box.em h4 { color:#8b2a18; }
/* Override: show seasonal hours block, hide old grid */
.hours-flex { display:none !important; }
.hours-season { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; margin-top:8px; }
.fullbleed { width: 100vw; margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw); padding-left: 16px; padding-right: 16px; }

/* Booking blocks */
.calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
.day { border: 1px solid #e6e6e6; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; user-select: none; background: #fafafa; font-weight: 700; }
.calendar .day:nth-child(odd):not(.disabled) { background: #f6fbff; }
.day:hover { background: #f0f7ff; }
.day.disabled { color: #bbb; background: #f8f8f8; cursor: not-allowed; text-decoration: line-through; }
.day.selected { outline: 3px solid var(--brand); background: var(--sky); }

/* Calendar visual tweaks */
.calendar-block { background: linear-gradient(180deg, #fbfdff 0%, #f5f9ff 100%); border: 1px solid #e3ecf7; border-radius: 14px; padding: 12px; box-shadow: 0 8px 18px rgba(10,102,194,.06); }
.calendar .day { display: flex; align-items: center; justify-content: center; padding: 0; aspect-ratio: 1 / 1; background: #fff; border-color: #e6edf7; transition: background .2s ease, border-color .2s ease, transform .05s ease; }
.calendar .day.header { border-radius: 8px; }
.calendar .day:not(.disabled):hover { background: #f0f7ff; border-color: var(--brand); transform: translateY(-1px); }
.calendar .day.selected { outline: 3px solid var(--brand); background: var(--sky); border-color: var(--brand); box-shadow: 0 6px 16px rgba(232,97,63,.15); }
.calendar .day:focus-visible { outline: 3px solid var(--brand); outline-offset: 2px; }

/* Calendar weekday header (distinct, darker tone) */
.calendar .day.header { text-decoration: none; cursor: default; pointer-events: none; color: #18343a; background: linear-gradient(180deg, var(--sky) 0%, var(--mint) 100%); font-weight: 800; text-transform: uppercase; letter-spacing: .5px; font-size: 12px; border-color: #cfe0e2; }
/* Calendar month label */
.calendar-head { display:flex; align-items:center; justify-content:center; gap:8px; margin: 6px 0 10px; font-weight:800; color:#244b6b; }
.cal-btn { width:28px; height:28px; border:1px solid #e3ecf7; border-radius:8px; background:#fff; color:#244b6b; font-weight:800; line-height:1; display:flex; align-items:center; justify-content:center; cursor:pointer; }
.cal-btn:hover { background:#eef3f9; }
.cal-btn:focus { outline: 2px solid var(--brand); outline-offset: 2px; }
.cal-btn:disabled { opacity: .5; cursor: not-allowed; filter: grayscale(1); }

.slots { display: flex; flex-wrap: wrap; gap: 8px; }
.slot { padding: 10px 12px; border: 1px solid #e6e6e6; border-radius: 10px; cursor: pointer; background: #fff; }
.slot.disabled { color: #bbb; background: #f8f8f8; cursor: not-allowed; text-decoration: line-through; }
.slot.selected { background: var(--accent); color: #fff; border-color: var(--accent); }
.slot-wrap { position: relative; }
.slot-wrap .soldout { position: absolute; top: -8px; right: -8px; background:#e14a4a; color:#fff; font-size:10px; padding:2px 6px; border-radius:999px; box-shadow:0 2px 6px rgba(0,0,0,.2); }

.tickets { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; column-gap: 12px; row-gap: 12px; align-items: start; }
.qty { display: inline-flex; align-items: center; border: 1px solid #e6e6e6; border-radius: 8px; overflow: hidden; }
.qty button { width: 40px; height: 40px; border: 0; background: #eef3f9; color:#244b6b; cursor: pointer; font-size: 18px; }
.qty input { width: 56px; border: 0; text-align: center; font-weight: 700; font-size: 16px; }
.price { font-weight: 800; font-size: 18px; color: var(--brand); }
.total { font-size: 20px; font-weight: 800; background: var(--sky); border:1px solid #d9eaff; color: var(--brand-dark); padding:8px 12px; border-radius:10px; }
/* Tickets area emphasis */
.tickets strong { font-size: 16px; color: #244b6b; }

/* Ticket list (row layout like screenshot) */
.ticket-list { display: grid; gap: 6px; }
.ticket-list.with-topline { border-top: 3px solid #d9eaff; padding-top: 6px; border-radius: 2px; }
.ticket-row { display: grid; grid-template-columns: 1fr auto auto auto auto; align-items: center; padding: 12px 8px; border-bottom: 1px solid #edf0f3; }
.ticket-row:last-child { border-bottom: 0; }
.ticket-title { display: grid; gap: 6px; }
.ticket-title strong { font-size: 16px; color: #182430; }
.ticket-subtitle { font-size: 13px; color: #6b7785; font-style: italic; display:inline-flex; align-items:center; gap:6px; }
.ticket-subtitle .info-ic { width:18px; height:18px; border-radius:999px; border:1px solid #d9eaff; background: var(--sky); color: var(--brand); display:inline-flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; line-height:1; }
/* Emphasis for tour duration */
.time-pill { display:inline-flex; align-items:center; gap:6px; padding:2px 8px; background: var(--sky); border:1px solid #d9eaff; color: var(--brand-dark); border-radius:999px; font-weight:800; font-size:12px; }
/* Remaining pill for tours */
.remain-pill { display:inline-flex; align-items:center; gap:6px; padding:2px 8px; background:#f6faff; border:1px solid #e3ecf7; color:#244b6b; border-radius:999px; font-weight:800; font-size:12px; }
.ticket-price { font-weight: 800; font-size: 18px; padding: 0 8px; }
.price-green { color: #3a6ea5; }
.price-free { color: #3a6ea5; font-weight: 900; }
.circle-btn { width: 36px; height: 36px; border-radius: 999px; border: 1px solid #e0e6ee; display: inline-flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; }
.circle-btn.minus { background: #f3f6fb; color: #5e6f84; }
.circle-btn.plus { background: var(--sky); color: var(--brand); border-color: #d9eaff; }
.circle-btn.plus:hover { background: #dfefff; }
.circle-btn:disabled { opacity: .5; cursor: not-allowed; }
.ticket-qty { width: 28px; text-align: center; font-weight: 800; color: #2b3a4a; }
/* Tour rows align to ticket style */
.ticket-row.tour { grid-template-columns: auto 1fr auto auto auto auto; column-gap: 8px; }
.ticket-row.tour input[type="radio"] { transform: scale(1.05); accent-color: var(--brand); }

/* Sticky booking bar */
.booking-bar { position: sticky; bottom: 0; z-index: 15; background: #ffffffee; backdrop-filter: saturate(180%) blur(8px); border-top: 3px solid var(--brand); }
.booking-inner { display: grid; grid-template-columns: repeat(6, 1fr); grid-template-areas:
    'date time tickets tours audio button'
    'summary summary summary summary summary button';
  gap: 10px 12px; align-items: center; padding: 12px 16px; }
.booking-inner #pill-date, .booking-inner #pill-time, .booking-inner #pill-count, .booking-inner #pill-tours, .booking-inner #pill-audio, .booking-inner #summary { display: none; }
.booking-inner #pill-date { grid-area: date; background: #fff; border-color: #e6e6e6; }
.booking-inner #pill-time { grid-area: time; background: #fff; border-color: #e6e6e6; }
.booking-inner #pill-count { grid-area: tickets; background: #fff; border-color: #e6e6e6; }
.booking-inner #pill-tours { grid-area: tours; background: #fff; border-color: #e6e6e6; }
.booking-inner #pill-audio { grid-area: audio; background: #fff; border-color: #e6e6e6; }
.booking-inner #summary { grid-area: summary; }
/* total pill removed from layout as requested */
.booking-inner #book-btn { grid-area: button; }

@media (max-width: 768px) {
  .booking-inner { grid-template-columns: 1fr 1fr; grid-template-areas:
      'date time'
      'tickets tours'
      'summary summary'
      'audio button'; }
}
.booking-inner .pill { border: 1px solid #e6e6e6; border-radius: 999px; padding: 8px 12px; background: #fff; min-height: 40px; display: flex; align-items: center; }
.booking-inner .cta { background: var(--accent); color: #fff; padding: 12px 20px; border-radius: 10px; font-weight: 700; cursor: pointer; border: none; }
.booking-inner .cta:disabled { filter: grayscale(1); opacity: .6; cursor: not-allowed; }
/* Booking summary list */
.summary-list { font-size: 14px; color: #2b3a4a; border-top: 1px solid #edf0f3; padding-top: 8px; display: grid; gap: 6px; }
.summary-item { display:flex; align-items:center; justify-content:space-between; }
.summary-item .label { font-weight: 700; }
.summary-item .value { font-weight: 700; color: #22313f; }
/* Calendar compact tweaks */
.calendar { gap: 4px; }
.calendar-head { margin: 2px 0 6px; }
.calendar-block { padding: 8px; }
.calendar .day { aspect-ratio: 4 / 3; font-size: 14px; }
.calendar .day.header { padding: 0; font-size: 12px; }
</style>
</head>
<body>

<header>
	<div class="container nav">
		<div class="brand">Austrian National Library</div>
		<nav>
			<a href="#hours">Hours</a>
			<a href="#tickets">Tickets</a>
			<a href="#tour">Tour Guide</a>
		</nav>
	</div>
</header>

<section class="cover" aria-label="Top image">
	<div class="container cover-inner">
		<img src="https://raw.githubusercontent.com/HuaqingYuan1/my-html-demo/main/cover3.jpg" alt="Austrian National Library">
		<div class="overlay">
			<div class="content">
				<h1 class="title">Austrian National Library</h1>
				<p class="subtitle">Ticket Booking</p>
				<p class="address-line" style="margin-top:8px; opacity:.95; font-size:14px;">Josefsplatz 1, 1010 Wien</p>
			</div>
		</div>
	</div>
</section>

<main class="container">
	<section id="hours" style="border-bottom:0;">
		<div class="section-card">
		<h2 class="heading-accent center">Opening Hours</h2>
		<div class="hours-card">
			<div class="hours-season">
				<div class="hour-box">
					<h4 style="font-size: 18px;">October – May</h4>
					<p>Closed on Mondays</p>
					<p>Tuesday – Wednesday: 9 a.m. – 6 p.m.</p>
					<p>Thursday: 9 a.m. – 9 p.m.</p>
					<p>Friday – Sunday: 9 a.m. – 6 p.m.</p>
				</div>
				<div class="hour-box em">
					<h4 style="font-size: 18px;">June – September</h4>
					<p>Monday: 9 a.m. – 6 p.m.</p>
					<p>Tuesday – Wednesday: 9 a.m. – 6 p.m.</p>
					<p>Thursday: 9 a.m. – 9 p.m.</p>
					<p>Friday – Sunday: 9 a.m. – 6 p.m.</p>
				</div>
			</div>
        </div>
        <div class="grid">
			<div class="col-12">
				<div class="hours-card">
					<div class="hours-flex">
						<div class="hour-box">
							<h4>Tuesday – Sunday</h4>
							<p>10:00 a.m. – 6:00 p.m.</p>
						</div>
						<div class="hour-box em">
							<h4>Thursday & Public Holidays</h4>
							<p>10:00 a.m. – 9:00 p.m. <span class="hours-em">open late</span></p>
						</div>
						<div class="hour-box">
							<h4>Notes</h4>
							<p>Closed on Monday</p>
        </div>
        </div>

					<p class="hours-note">Time slots are released every 30 minutes.</p>
				</div>
			</div>
			<!-- Address moved to cover; right column removed as requested -->
		</div>
		</div>
	</section>

	<section id="visit" style="border-bottom:0;">
		<div class="section-card">
		<h2 class="heading-accent center">Select Your Visit</h2>
		<div class="grid">
			<div class="col-6">
                    <div class="section-card fill">
                    <h3 class="subheading">Choose Date & Time</h3>
                    <div class="calendar-block">
                        <div class="calendar-head"><button id="cal-prev" class="cal-btn" aria-label="Previous month" disabled>‹</button><span id="calendar-month-label"></span><button id="cal-next" class="cal-btn" aria-label="Next month" disabled>›</button></div>
                        <div class="calendar" id="calendar-grid" aria-label="August 2026 calendar"></div>
                    </div>
					<div style="height:12px"></div>
					<div id="slots" class="slots" aria-live="polite"></div>
					<p id="closed-note" class="muted" style="display:none;">Closed</p>
				</div>
			</div>
			<div class="col-6">
                    <div class="section-card fill">
                        <h3 class="subheading">Select Tickets</h3>
                        <div class="section-note small"><span class="info-ic lg">⏰</span><span>Important: Please arrive 15 minutes before your selected time. </span></div>
                        <div class="section-note small"><span class="info-ic lg">🔔</span><span>Online admission tickets are valid indefinitely during our opening hours.</span></div>
                        
                        <div class="ticket-list with-topline" role="list">
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Adults</strong></div>
                                <div class="ticket-price price-green">€11.00</div>
                                <button class="circle-btn minus" data-minus="full" aria-label="Decrease adults">−</button>
                                <div class="ticket-qty" data-qty-num="full">0</div>
                                <button class="circle-btn plus" data-plus="full" aria-label="Increase adults">+</button>
                                <input id="qty-full" value="0" readonly hidden>
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Pensioners</strong><div class="ticket-subtitle"><span class="info-ic">!</span>Over 65 or with valid pensioner ID.</div></div>
                                <div class="ticket-price price-green">€8.50</div>
                                <button class="circle-btn minus" data-minus="full" aria-label="Decrease adults">−</button>
                                <div class="ticket-qty" data-qty-num="full">0</div>
                                <button class="circle-btn plus" data-plus="full" aria-label="Increase adults">+</button>
                                <input id="qty-full" value="0" readonly hidden>
                            </div>
                            
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Reductions</strong><div class="ticket-subtitle"><span class="info-ic">!</span>Students under 27 years, individuals doing military and civilian service, holders of an identity card for disabled persons, friends of cooperating museums and organisations receive discounted admission to all museums of the Austrian National Library with their ID.</div></div>
                                <div class="ticket-price price-green">€8.00</div>
                                <button class="circle-btn minus" data-minus="senior" aria-label="Decrease seniors">−</button>
                                <div class="ticket-qty" data-qty-num="senior">0</div>
                                <button class="circle-btn plus" data-plus="senior" aria-label="Increase seniors">+</button>
                                <input id="qty-senior" value="0" readonly hidden>
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Child under 19</strong><div class="ticket-subtitle"><span class="info-ic">!</span>Can only be purchased with at least one adult ticket.</div></div>
                                <div class="ticket-price price-green">€0.00</div>
                                <button class="circle-btn minus" data-minus="senior" aria-label="Decrease seniors">−</button>
                                <div class="ticket-qty" data-qty-num="senior">0</div>
                                <button class="circle-btn plus" data-plus="senior" aria-label="Increase seniors">+</button>
                                <input id="qty-senior" value="0" readonly hidden>
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Group price per person</strong><div class="ticket-subtitle"><span class="info-ic">!</span>10 people or more</div></div>
                                <div class="ticket-price price-green">€8.00</div>
                                <button class="circle-btn minus" data-minus="discount" aria-label="Decrease discount">−</button>
                                <div class="ticket-qty" data-qty-num="discount">0</div>
                                <button class="circle-btn plus" data-plus="discount" aria-label="Increase discount">+</button>
                                <input id="qty-discount" value="0" readonly hidden>
                            </div>

                        </div>
                        <p class="muted" id="breakdown"></p>
                    </div>
                </div>
		</div>
		</div>
	</section>

	<section id="tour">
		<div class="section-card">
		<h2 class="heading-accent center">Tour Guide & Audio Guide</h2>
		<div class="section-note">🔔<span>Notes: The price for guided tours or audio guides does not include admission.
            A valid ticket is required for entry.</span></p>
            
        </div>
        <div class="grid">
            <div class="col-7">
                <div class="section-card fill">
                    <h3 class="subheading">Guided tour</h3>
                    <div class="section-note small"><span class="info-ic lg">⏱️</span><span>Duration: approx. 45 minutes</span></div>
                    <div class="section-note small"><span class="info-ic lg">📍</span><span>Meeting point: Service Desk State Hall, Josefsplatz 1, 1010 Vienna</span></div>
                    <div class="section-note small"><span class="info-ic lg">🗣️</span><span>Language: English</span></div>
                    <div class="panel-divider"></div>
                    <div class="ticket-list" role="list">
                            <div class="ticket-row tour" role="listitem">
                                <input class="radio" type="checkbox" name="tour-option" value="child">
                                <div class="ticket-title"><strong>Child U19</strong><div class="ticket-subtitle"><span class="info-ic">!</span>Guided tour incl. admission <span class="remain-pill" data-remain-for="tour_child">Remaining: —</span></div></div>
                                <div class="ticket-price price-green">€3.30</div>
                                <button class="circle-btn minus" data-minus="tour_child" aria-label="Decrease guided tour children">−</button>
                                <div class="ticket-qty" data-qty-num="tour_child">0</div>
                                <button class="circle-btn plus" data-plus="tour_child" aria-label="Increase guided tour children">+</button>
                                <input id="qty-tour-child" value="0" readonly hidden>
                            </div>
                            <div class="ticket-row tour" role="listitem">
                                <input class="radio" type="checkbox" name="tour-option" value="adult">
                                <div class="ticket-title"><strong>Adult</strong><div class="ticket-subtitle"><span class="info-ic">!</span>Guided tour incl. admission <span class="remain-pill" data-remain-for="tour_adult">Remaining: —</span></div></div>
                                <div class="ticket-price price-green">€16.00</div>
                                <button class="circle-btn minus" data-minus="tour_adult" aria-label="Decrease guided tour adults">−</button>
                                <div class="ticket-qty" data-qty-num="tour_adult">0</div>
                                <button class="circle-btn plus" data-plus="tour_adult" aria-label="Increase guided tour adults">+</button>
                                <input id="qty-tour-adult" value="0" readonly hidden>
                            </div>
                           
                    </div>
                    <div style="display:flex; justify-content:flex-end; align-items:center; margin-top:12px;">
                        <p class="muted" id="tour-price-note" style="margin:0;">Price: —</p>
                    </div>
                </div>
            </div>
            <div class="col-5">
                <div class="section-card fill">
                    <h3 class="subheading">Audio Guides</h3>
                    <div class="panel-divider"></div>
                    <div class="section-note small"><span class="info-ic lg">🌐</span><span>Audio guides available in: DE, ENG, ITA, SPA, FRA, JPN, CHN, UA.</span></div>
                    <div class="section-note small"><span class="info-ic lg">🎧</span><span>Audio guides with friendly support</span></div>
                    <div class="ticket-list" role="list">
                            
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Audio Guide</strong><div class="ticket-subtitle"><span class="info-ic">!</span>one person</div></div>
                                <div class="ticket-price price-green">€3.00</div>
                                <button class="circle-btn minus" data-minus="ag9" aria-label="Decrease family guide">−</button>
                                <div class="ticket-qty" data-qty-num="ag9">0</div>
                                <button class="circle-btn plus" data-plus="ag9" aria-label="Increase family guide">+</button>
                                <input id="qty-ag9" value="0" readonly hidden>
                            </div>
                            <div class="ticket-row" role="listitem">
                                <div class="ticket-title"><strong>Audio Guide Group</strong><div class="ticket-subtitle"><span class="info-ic">!</span>for two or more</div></div>
                                <div class="ticket-price price-green">€2.50</div>
                                <button class="circle-btn minus" data-minus="ag4" aria-label="Decrease group guide">−</button>
                                <div class="ticket-qty" data-qty-num="ag4">0</div>
                                <button class="circle-btn plus" data-plus="ag4" aria-label="Increase group guide">+</button>
                                <input id="qty-ag4" value="0" readonly hidden>
                            </div>
                            
                    </div>
                </div>
            </div>
		</div>
		</div>
</section>

<!-- Exhibitions (placed after Tour Guide & Audio Guide, before Final Summary) -->
<section class="container">
        <div class="section-card" style="margin-top:12px;">
        <h2 class="heading-accent center">Exhibitions</h2>
        <span class="muted" style="font-size:14px;display:block;margin-top:6px; text-align:center;">Special exhibitions are included with museum admission</span>
        <div class="panel-divider"></div>
        <style>
        /* Emphasize only the first subtitle (the date); keep description normal */
        .exh-first .ticket-subtitle:first-of-type { font-weight: 800; color: #22313f; font-size: 15px; }
        </style>
        <div class="grid" style="grid-template-columns: repeat(2, minmax(0,1fr)); grid-gap: 12px;">
            <div class="card accent">
                <div class="body">
                    <div class="ticket-title" style="margin-bottom:10px;"><strong style="font-size:20px;">Vocation: Superstar. 200th anniversary of the birth of Johann Strauss II</strong></div>
                    <div class="ticket-subtitle" style="font-weight:800; color:#22313f; font-size:15px;">October 21, 2025 – August 11, 2026</div>
                    <p class="muted" style="margin:6px 0 10px;"><strong>Exhibition hours: 10:00 a.m. – 12:00 p.m.</strong></p>
                    <div class="ticket-subtitle" style="margin-top:10px;">October 25, 2025, marks the 200th anniversary of the birth of Johann Strauss II. A superstar even during his lifetime, he lived a life within fluid boundaries: night became day, the private became public, his job became his purpose in life. He was driven by an indefatigable passion, a passion made tangible by the small but exquisite display in the State Hall comprising of remarkable objects from the holdings of the Austrian National Library. Originals, sketches, and drafts testify to his energy as a composer, while letters and photos provide insights into his personal connections.</div>
                    
                </div>
            </div>
            <div class="card accent">
                <div class="body">
                    <div class="ticket-title" style="margin-bottom:10px;"><strong style="font-size:20px;">Medicine through the ages. From Antiquity to the Age of Modernism</strong></div>
                    <div class="ticket-subtitle" style="font-weight:800; color:#22313f; font-size:15px;">August 4, 2026 – August 28, 2026</div>
                    <p class="muted" style="margin:6px 0 10px;"><strong>Exhibition hours: 1:00 p.m. – 5:00 p.m.</strong></p>
                    <div class="ticket-subtitle" style="margin-top:10px;">The exhibition in the State Hall invites visitors to immerse themselves in the development of healthcare from antiquity to the early 20th century, with a special focus on Vienna. It also addresses the tension between academic medicine and naturopathy in antiquity and the Middle Ages. The Austrian National Library is opening its unique collection on the history of medicine, casting a spotlight on the achievements and ruptures of past eras. One of the highlights is the famous Tacuinum sanitatis, a household book on healthy living written around 1400, whose magnificent illustrations offer an extraordinary insight into the understanding of health in the Middle Ages.</div>
                    
                </div>
            </div>
        </div>
    </div>
</section>

</main>


<div class="booking-bar">
	<div class="container booking-inner">
		<div class="pill" id="pill-date">Date: <span style="margin-left:6px;" id="pill-date-text">Select</span></div>
		<div class="pill" id="pill-time">Time: <span style="margin-left:6px;" id="pill-time-text">Select</span></div>
		<div class="pill" id="pill-count">Tickets: <span style="margin-left:6px;" id="pill-count-text">0</span></div>
		<div class="pill" id="pill-tours">Guided tour: <span style="margin-left:6px;" id="pill-tours-text">0</span></div>
		<div class="pill" id="pill-audio">Audio Guides: <span style="margin-left:6px;" id="pill-audio-text">0</span></div>
		<div id="summary" class="summary-list" aria-live="polite"></div>
	</div>
</div>

<section class="final-summary">
	<div class="container">
		<div class="final-dt">Date: <span id="final-date-text">Select</span> <span class="sep">•</span> Time: <span id="final-time-text">Select</span></div>
		<div class="final-divider"></div>
		<div id="final-breakdown" class="final-list" aria-live="polite"></div>
		<div class="total-banner">Total: <span id="final-total-text">€0.00</span></div>
		<div id="success-message" class="success-banner">Successfully</div>
		<button id="book-btn" class="final-cta" disabled>BOOK NOW</button>
	</div>
</section>



<footer>
	<div class="container">
		<p class="muted">© <span id="year"></span> Austrian National Library (Unofficial Demo)</p>
	</div>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

// Constants
const ATTRACTION_NAME = 'Austrian National Library';
const CAL_YEAR = 2026;
const CAL_MONTH = 7; // August (0-based)
// Ticket prices (in EUR)
// Adults €11; Reductions (Student/Discount) €8; Pensioners €8.5; Under 19 free
const PRICES = { full: 11, senior: 8.5, student: 8, discount: 8, child: 0 };
const TICKET_LABELS = {
    full: 'Adults',
    senior: 'Pensioners',
    student: 'Reductions',
    discount: 'Group price per person',
    child: 'Child under 19'
};
const TOUR_OPTIONS = {
	child: { label: 'Child U19 · Guided tour incl. admission', price: 3.3, max: 25 },
	adult: { label: 'Adult · Guided tour incl. admission', price: 16, max: 25 },
	// Additional legacy tour options removed from UI but can be reintroduced if needed
};
// Audio guide prices (set group 10+ to €8 as requested)
const AUDIO_GUIDE_PRICES = { ag6: 3, ag8: 3, ag9: 3, ag4: 2.5, ag3: 3 };
const AUDIO_LABELS = { ag6: 'Audio Guide', ag8: 'Audio Guide "Take 2"', ag9: 'Audio Guide', ag4: 'Audio Guide Group', ag3: 'Audio Guide (Annual pass)' };

// Elements
const calendarGrid = document.getElementById('calendar-grid');
const calendarMonthLabel = document.getElementById('calendar-month-label');
const calPrev = document.getElementById('cal-prev');
const calNext = document.getElementById('cal-next');
const MONTH_NAMES = ['January','February','March','April','May','June','July','August','September','October','November','December'];
const MONTH_ABBR = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
let viewYear = CAL_YEAR;
let viewMonth = CAL_MONTH; // 0-based

// Lock navigation to August only (buttons present but disabled)
if (calPrev) calPrev.disabled = true;
if (calNext) calNext.disabled = true;
const slotsWrap = document.getElementById('slots');
const closedNote = document.getElementById('closed-note');
const bookBtn = document.getElementById('book-btn');
const pillDateText = document.getElementById('pill-date-text');
const pillTimeText = document.getElementById('pill-time-text');
const finalDateText = document.getElementById('final-date-text');
const finalTimeText = document.getElementById('final-time-text');
const pillCountText = document.getElementById('pill-count-text');
const pillToursText = document.getElementById('pill-tours-text');
const pillAudioText = document.getElementById('pill-audio-text');
const summaryEl = document.getElementById('summary');
const finalBreakdownEl = document.getElementById('final-breakdown');
const totalEl = document.getElementById('total');
const breakdownEl = document.getElementById('breakdown');
const finalTotalText = document.getElementById('final-total-text');
// total pill removed; keep logic via lastTotal if needed

const qtyInputs = {
	full: document.getElementById('qty-full'),
	senior: document.getElementById('qty-senior'),
	student: document.getElementById('qty-student'),
	discount: document.getElementById('qty-discount'),
	child: document.getElementById('qty-child'),
	// Tour options (multi-select quantities)
	our_child: document.getElementById('qty-tour-child'),
	tour_adult: document.getElementById('qty-tour-adult'),
	ag6: document.getElementById('qty-ag6'),
	ag8: document.getElementById('qty-ag8'),
	ag9: document.getElementById('qty-ag9'),
	ag4: document.getElementById('qty-ag4'),
	ag3: document.getElementById('qty-ag3')
};

// Normalize mismatched ticket row bindings (fix wrongly wired data-* and inputs)
function normalizeTicketRows(){
  const titleToKey = {
    'Adults': 'full',
    'Pensioners': 'senior',
    'Reductions': 'student',
    'Group price per person': 'discount',
    'Child under 19': 'child'
  };
  document.querySelectorAll('.ticket-row').forEach(row=>{
    const title = row.querySelector('.ticket-title strong')?.textContent?.trim();
    const key = titleToKey[title];
    if (!key) return;
    const minus = row.querySelector('[data-minus]');
    const plus = row.querySelector('[data-plus]');
    const qtyNum = row.querySelector('[data-qty-num]');
    if (minus) minus.setAttribute('data-minus', key);
    if (plus) plus.setAttribute('data-plus', key);
    if (qtyNum) qtyNum.setAttribute('data-qty-num', key);
    // Ensure hidden input id matches expected key
    const hidden = Array.from(row.querySelectorAll('input[id]')).find(i=> i.id.startsWith('qty-'));
    if (hidden && hidden.id !== `qty-${key}`){
      hidden.id = `qty-${key}`;
    } else if (!hidden){
      const el = document.createElement('input');
      el.id = `qty-${key}`; el.value = '0'; el.hidden = true; el.readOnly = true;
      row.appendChild(el);
    }
  });
  // Refresh qtyInputs references after normalization
  qtyInputs.full = document.getElementById('qty-full');
  qtyInputs.senior = document.getElementById('qty-senior');
  qtyInputs.student = document.getElementById('qty-student');
  qtyInputs.discount = document.getElementById('qty-discount');
  qtyInputs.child = document.getElementById('qty-child');
}

// Tour selectors (checkboxes now, allow multi-select)
const tourOptionRadios = () => Array.from(document.querySelectorAll('input[name="tour-option"]'));
const tourPriceNote = document.getElementById('tour-price-note');

let selectedDate = null; // { day, weekday }
let selectedTime = null; // 'HH:MM'
let tourRemainingByKey = {}; // per tour option remaining cache
let lastTotal = 0; // cached total value

function pad(n){ return String(n).padStart(2,'0'); }

function weekdayOf(y,m,d){ return new Date(y,m,d).getDay(); } // 0 Sun ... 6 Sat

function isPublicHoliday(y,m,d){
	// Placeholder — for demo, assume no special public holidays beyond rules
	return false;
}

function isClosedWeekday(weekday){
    // Summer (June–September): Mondays open; otherwise closed on Mondays
    // JS weekday: 0=Sun, 1=Mon, ..., 6=Sat
    const isSummer = (viewMonth >= 5 && viewMonth <= 8); // Jun..Sep
    if (isSummer) return false;
    return weekday === 1; // Monday (Oct–May)
}

// Fixed Sold-Out configuration and helpers
// Optional explicit list: { 'YYYY-MM-DD': ['HH:MM','HH:MM', ...] }
const FIXED_SOLD_OUT = {};

function hashStr(s){
    // Simple FNV-1a-like hash for deterministic pseudo-random
    let h = 2166136261;
    for (let i = 0; i < s.length; i++){
        h ^= s.charCodeAt(i);
        h = Math.imul(h, 16777619) >>> 0;
    }
    return h >>> 0;
}

function isSlotSoldOut(y, m, d, time){
    const dateKey = `${y}-${pad(m+1)}-${pad(d)}`;
    const listed = FIXED_SOLD_OUT[dateKey];
    if (Array.isArray(listed)) return listed.includes(time);
    // Deterministic fallback (~10%) based on date+time
    const key = `${dateKey}|${time}`;
    return (hashStr(key) % 10) === 0;
}

function buildCalendar(){
    if (calendarMonthLabel) {
        calendarMonthLabel.textContent = `${MONTH_NAMES[viewMonth]}`;
    }
    calendarGrid.setAttribute('aria-label', `${MONTH_NAMES[viewMonth]} ${viewYear} calendar`);
    calendarGrid.innerHTML = '';
    const first = new Date(viewYear, viewMonth, 1);
    const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();
	// Render weekday headers for variety in style
	const headers = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    for (const h of headers){
        const hd = document.createElement('div');
        hd.className = 'day header';
        hd.textContent = h;
        calendarGrid.appendChild(hd);
    }
	// Fill leading blanks from Sunday
    const startDow = first.getDay();
	for (let i=0;i<startDow;i++){
		const blank = document.createElement('div');
		blank.className = 'day disabled';
		blank.textContent = '';
		calendarGrid.appendChild(blank);
	}
	for (let d=1; d<=daysInMonth; d++){
        const dow = weekdayOf(viewYear, viewMonth, d);
		const cell = document.createElement('div');
		cell.className = 'day';
		cell.setAttribute('role','button');
		cell.setAttribute('aria-label', `August ${d}, ${CAL_YEAR}`);
		cell.textContent = String(d);
		cell.dataset.day = String(d);
		if (isClosedWeekday(dow)){
			cell.classList.add('disabled');
			cell.title = 'Closed (Monday)';
		} else {
            cell.addEventListener('click', ()=> selectDate(d));
        }
        calendarGrid.appendChild(cell);
    }
}

function selectDate(day){
    selectedDate = { year: viewYear, month: viewMonth, day, weekday: weekdayOf(viewYear, viewMonth, day) };
    selectedTime = null;
    [...calendarGrid.querySelectorAll('.day')].forEach(el=> el.classList.remove('selected'));
    const target = calendarGrid.querySelector(`.day[data-day="${day}"]`);
    if (target) target.classList.add('selected');
    pillDateText.textContent = `${MONTH_ABBR[viewMonth]} ${day}`;
    pillTimeText.textContent = 'Select';
    if (finalDateText) finalDateText.textContent = `${viewYear}-${pad(viewMonth+1)}-${pad(day)}`;
    if (finalTimeText) finalTimeText.textContent = 'Select';
    buildSlotsForDay(day);
    enableOrDisableBook();
}

function buildSlotsForDay(day){
    slotsWrap.innerHTML = '';
    const dow = weekdayOf(viewYear, viewMonth, day);
    const closed = isClosedWeekday(dow);
    const holiday = isPublicHoliday(viewYear, viewMonth, day);
    if (closed){
        closedNote.style.display = '';
        return;
    }
	closedNote.style.display = 'none';
	// Opening window
	const isSummer = (viewMonth >= 5 && viewMonth <= 8); // Jun..Sep
	const openHour = isSummer ? 9 : 10;
	const closeHour = holiday || dow === 4 ? 21 : 18; // Thu=4 → 21:00
	const slots = [];
	for (let h=openHour; h<closeHour; h++){
		for (let m of [0,30]){
			slots.push(`${pad(h)}:${pad(m)}`);
		}
	}
	// Render
	slots.forEach(time=>{
		const wrap = document.createElement('div');
		wrap.className = 'slot-wrap';
		const s = document.createElement('button');
		s.type = 'button';
		s.className = 'slot';
		s.textContent = time;
		const sold = isSlotSoldOut(viewYear, viewMonth, day, time);
		if (sold){
			s.classList.add('disabled');
			s.disabled = true;
			const tag = document.createElement('span');
			tag.className = 'soldout';
			tag.textContent = 'Sold Out';
			wrap.appendChild(tag);
		}
        s.addEventListener('click', ()=>{
            selectedTime = time;
            [...slotsWrap.children].forEach(c=> c.querySelector('.slot')?.classList.remove('selected'));
            s.classList.add('selected');
            pillTimeText.textContent = time;
            if (finalTimeText) finalTimeText.textContent = time;
            enableOrDisableBook();
            tourRemainingByKey = {}; // reset remaining cache per new timeslot
            updateTourPriceNote();
            refreshTourRemainingUI();
        });
		wrap.appendChild(s);
		slotsWrap.appendChild(wrap);
	});
}

function updateTotals(){
    let total = 0;
    const parts = [];
    // Standard tickets
    let ticketCount = 0; let ticketTotal = 0;
    for (const key of ['full','senior','student','discount','child']){
        const qty = parseInt((qtyInputs[key]?.value)||'0',10);
        if (!qty) continue;
        const price = PRICES[key];
        total += qty * price;
        ticketCount += qty;
        ticketTotal += qty * price;
        const label = TICKET_LABELS[key] || (key === 'full' ? 'Full' : key.charAt(0).toUpperCase()+key.slice(1));
        parts.push(`${qty} × €${price.toFixed(2)} (${label})`);
    }
    // Tour guide (multi-select)
    let tourCount = 0; let tourTotal = 0;
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const qtyKey = `tour_${optKey}`;
        const people = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
        if (!people) continue;
        const opt = TOUR_OPTIONS[optKey];
        total += people * opt.price;
        tourCount += people;
        tourTotal += people * opt.price;
        parts.push(`${people} × €${opt.price.toFixed(2)} (Tour ${opt.label})`);
    }
    // Audio guides
    let audioCount = 0; let audioTotal = 0;
    for (const ag of ['ag6','ag8','ag9','ag4','ag3']){
        const q = parseInt((qtyInputs[ag]?.value)||'0',10);
        if (!q) continue;
        const price = AUDIO_GUIDE_PRICES[ag];
        total += q * price;
        audioCount += q;
        audioTotal += q * price;
        parts.push(`${q} × €${price.toFixed(2)} (${ag.toUpperCase()})`);
    }
    lastTotal = total;
    if (totalEl) totalEl.textContent = `Total: €${total.toFixed(2)}`;
    if (breakdownEl) breakdownEl.textContent = parts.join(' + ');
    // Update final bottom total banner
    if (finalTotalText) finalTotalText.textContent = `€${total.toFixed(2)}`;
    // total pill removed from footer; total stays in lastTotal
    pillCountText.textContent = `${ticketCount} (€${ticketTotal.toFixed(2)})`;
    if (pillToursText) pillToursText.textContent = `${tourCount} (€${tourTotal.toFixed(2)})`;
    if (pillAudioText) pillAudioText.textContent = `${audioCount} (€${audioTotal.toFixed(2)})`;
    // Render compact summary lines (only show purchased categories)
    if (summaryEl){
        const lines = [];
        if (ticketCount > 0){
            const val = ticketTotal > 0 ? `€${ticketTotal.toFixed(2)}` : 'Free';
            lines.push(`<div class="summary-item"><span class="label">Tickets (${ticketCount})</span><span class="value">${val}</span></div>`);
        }
        if (tourCount > 0){
            lines.push(`<div class="summary-item"><span class="label">Guided tour (${tourCount})</span><span class="value">€${tourTotal.toFixed(2)}</span></div>`);
        }
        if (audioCount > 0){
            lines.push(`<div class="summary-item"><span class="label">Audio Guides (${audioCount})</span><span class="value">€${audioTotal.toFixed(2)}</span></div>`);
        }
        summaryEl.innerHTML = lines.join('');
        summaryEl.style.display = lines.length ? '' : 'none';
    }
    // Sync visible quantities and button disabled states for ticket rows
    for (const key of ['full','senior','student','discount','child']){
        const val = parseInt((qtyInputs[key]?.value)||'0',10);
        const numEl = document.querySelector(`[data-qty-num="${key}"]`);
        if (numEl) numEl.textContent = String(val);
        const minusBtn = document.querySelector(`[data-minus="${key}"]`);
        if (minusBtn) minusBtn.disabled = val <= 0;
    }
    // Audio guides numbers and minus state
    for (const key of ['ag6','ag8','ag9','ag4','ag3']){
        const val = parseInt((qtyInputs[key]?.value)||'0',10);
        const numEl = document.querySelector(`[data-qty-num="${key}"]`);
        if (numEl) numEl.textContent = String(val);
        const minusBtn = document.querySelector(`[data-minus="${key}"]`);
        if (minusBtn) minusBtn.disabled = val <= 0;
    }
    // Tour per-option qty sync and controls enablement
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const qtyKey = `tour_${optKey}`;
        const val = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
        const numEl = document.querySelector(`[data-qty-num="${qtyKey}"]`);
        if (numEl) numEl.textContent = String(val);
        const minusBtn = document.querySelector(`[data-minus="${qtyKey}"]`);
        if (minusBtn) minusBtn.disabled = val <= 0;
    }
    refreshTourRemainingUI();

    // Render detailed final breakdown (each purchased ticket type)
    if (finalBreakdownEl){
        const items = [];
        // Standard tickets by type
        for (const key of ['full','senior','student','discount','child']){
            const qty = parseInt((qtyInputs[key]?.value)||'0',10);
            if (!qty) continue;
            const price = PRICES[key];
            const val = price > 0 ? `€${(qty*price).toFixed(2)}` : 'Free';
            items.push(`<div class=\"final-item\"><span class=\"label\">${TICKET_LABELS[key]} (${qty})</span><span class=\"value\">${val}</span></div>`);
        }
        // Tour options by type
        for (const optKey of Object.keys(TOUR_OPTIONS)){
            const qtyKey = `tour_${optKey}`;
            const people = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
            if (!people) continue;
            const opt = TOUR_OPTIONS[optKey];
            items.push(`<div class=\"final-item\"><span class=\"label\">Guided tour — ${opt.label} (${people})</span><span class=\"value\">€${(people*opt.price).toFixed(2)}</span></div>`);
        }
        // Audio guides by type
        for (const ag of ['ag6','ag8','ag9','ag4','ag3']){
            const q = parseInt((qtyInputs[ag]?.value)||'0',10);
            if (!q) continue;
            const price = AUDIO_GUIDE_PRICES[ag];
            items.push(`<div class=\"final-item\"><span class=\"label\">${AUDIO_LABELS[ag]} (${q})</span><span class=\"value\">€${(q*price).toFixed(2)}</span></div>`);
        }
        finalBreakdownEl.innerHTML = items.join('');
        finalBreakdownEl.style.display = items.length ? '' : 'none';
    }

    enableOrDisableBook();
}

function attachQtyHandlers(){
    const titleToKey = {
        'Adults': 'full',
        'Pensioners': 'senior',
        'Reductions': 'student',
        'Group price per person': 'discount',
        'Child under 19': 'child'
    };
    document.querySelectorAll('[data-plus]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
            let k = btn.getAttribute('data-plus');
            const row = btn.closest('.ticket-row');
            const title = row?.querySelector('.ticket-title strong')?.textContent?.trim();
            if (title && titleToKey[title]) k = titleToKey[title];
            if (k && k.startsWith('tour_')){
                const optKey = k.replace('tour_','');
                const opt = TOUR_OPTIONS[optKey];
                const cur = parseInt((qtyInputs[k]?.value)||'0',10);
                const rem = getOrComputeTourRemaining(optKey);
                const cap = Math.min(opt.max, rem);
                const next = Math.min(cur + 1, cap);
                if (!qtyInputs[k]) return; // safety
                qtyInputs[k].value = String(next);
                const cb = row?.querySelector('input[name="tour-option"]');
                if (cb) cb.checked = parseInt(qtyInputs[k].value,10) > 0;
                const rowQtyEl = row?.querySelector('.ticket-qty');
                if (rowQtyEl) rowQtyEl.textContent = String(next);
                const plusBtn = row?.querySelector(`[data-plus="tour_${optKey}"]`);
                if (plusBtn) plusBtn.disabled = next >= cap;
                if (cur === next && cap >= 0){
                    try { alert(`Cannot exceed remaining (${cap}) for this tour option.`); } catch(_){}
                }
            } else {
                if (k === 'child' && parseInt((qtyInputs.full?.value)||'0',10) < 1){
                    // Require at least one adult ticket
                    try { alert('Child tickets require at least one Adult ticket.'); } catch(_){}
                    return;
                }
                const cur = parseInt((qtyInputs[k]?.value)||'0',10);
                if (!qtyInputs[k]){
                    // Try to locate or create hidden input if missing
                    const el = document.getElementById(`qty-${k}`) || document.createElement('input');
                    if (!el.id) { el.id = `qty-${k}`; el.value = '0'; el.hidden = true; el.readOnly = true; document.body.appendChild(el); }
                    qtyInputs[k] = el;
                }
                qtyInputs[k].value = String(cur + 1);
                const rowQtyEl = row?.querySelector('.ticket-qty');
                if (rowQtyEl) rowQtyEl.textContent = String(cur + 1);
            }
            updateTotals();
            refreshTourRemainingUI();
        });
    });
    document.querySelectorAll('[data-minus]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
            let k = btn.getAttribute('data-minus');
            const row = btn.closest('.ticket-row');
            const title = row?.querySelector('.ticket-title strong')?.textContent?.trim();
            if (title && titleToKey[title]) k = titleToKey[title];
            if (k && k.startsWith('tour_')){
                const optKey = k.replace('tour_','');
                const cur = parseInt((qtyInputs[k]?.value)||'0',10);
                const next = Math.max(0, cur-1);
                if (!qtyInputs[k]) return;
                qtyInputs[k].value = String(next);
                const cb = row?.querySelector('input[name="tour-option"]');
                if (cb) cb.checked = next > 0;
                const rowQtyEl = row?.querySelector('.ticket-qty');
                if (rowQtyEl) rowQtyEl.textContent = String(next);
            } else {
                const cur = parseInt((qtyInputs[k]?.value)||'0',10);
                if (!qtyInputs[k]) return;
                const next = Math.max(0, cur-1);
                qtyInputs[k].value = String(next);
                const rowQtyEl = row?.querySelector('.ticket-qty');
                if (rowQtyEl) rowQtyEl.textContent = String(next);
            }
            updateTotals();
        });
    });
}

function randomRemaining(max){
	const min = Math.ceil(max*0.3);
	const rem = Math.floor(Math.random()*(max-min+1))+min;
	return Math.max(0, Math.min(max, rem));
}

let currentRemaining = null;

function updateTourPriceNote(){
    // Aggregate note for multi-select tours
    const picks = [];
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const qtyKey = `tour_${optKey}`;
        const n = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
        if (!n) continue;
        const opt = TOUR_OPTIONS[optKey];
        picks.push(`${opt.label}: ${n} × €${opt.price.toFixed(2)}`);
    }
    if (picks.length) {
        tourPriceNote.style.display = '';
        tourPriceNote.textContent = `Tours: ${picks.join(' • ')}`;
    } else {
        tourPriceNote.textContent = '';
        tourPriceNote.style.display = 'none';
    }
}

function getOrComputeTourRemaining(optKey){
    if (tourRemainingByKey[optKey] != null) return tourRemainingByKey[optKey];
    const opt = TOUR_OPTIONS[optKey];
    const rem = computeRemainingFromTime(opt.max);
    tourRemainingByKey[optKey] = rem;
    return rem;
}

function refreshTourRemainingUI(){
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const el = document.querySelector(`[data-remain-for="tour_${optKey}"]`);
        if (!el) continue;
        // Show remaining only when the checkbox is checked; otherwise show dash
        const cb = document.querySelector(`.ticket-row.tour input[name="tour-option"][value="${optKey}"]`);
        if (cb && cb.checked){
            el.textContent = `Remaining: ${getOrComputeTourRemaining(optKey)}`;
        } else {
            el.textContent = 'Remaining: —';
        }
    }
}

function computeRemainingFromTime(max){
	if (!selectedTime){ return randomRemaining(max); }
	const parts = selectedTime.split(':');
	const h = parseInt(parts[0],10);
	let desirability = 0; // 0 low, 0.5 medium, 1 peak
	if (h>=11 && h<15) desirability = 1; // midday peak
	if (selectedDate && selectedDate.weekday === 4 && h>=18 && h<21) desirability = 1; // Thu evening peak
	if (!desirability && ((h>=10 && h<11) || (h>=15 && h<18))) desirability = 0.5; // shoulder
	let minFrac, maxFrac;
	if (desirability === 1){ minFrac = 0.05; maxFrac = 0.35; }
	else if (desirability === 0.5){ minFrac = 0.2; maxFrac = 0.6; }
	else { minFrac = 0.4; maxFrac = 0.9; }
	const min = Math.max(1, Math.floor(max*minFrac));
	const maxN = Math.max(min, Math.floor(max*maxFrac));
	return Math.floor(Math.random()*(maxN-min+1)) + min;
}

function enableOrDisableBook(){
	const anyQty = Object.values(qtyInputs).some(i=> parseInt((i?.value)||'0',10) > 0);
	bookBtn.disabled = !(selectedDate && selectedTime && anyQty);
}

function buildApiParams(){
	if (!selectedDate) return null;
	return [ATTRACTION_NAME, `8.${selectedDate.day}`];
}

bookBtn.addEventListener('click', ()=>{
	const params = buildApiParams();
	const payload = {
		params,
        date: `${selectedDate.year}-${pad(selectedDate.month + 1)}-${pad(selectedDate.day)}`,
		time: selectedTime,
		quantities: Object.fromEntries(Object.entries(qtyInputs).map(([k,i])=>[k, parseInt(i.value||'0',10)])),
		tourSelection: (()=>{
			const r = tourOptionRadios().find(x=>x.checked);
			if (!r) return null;
			const opt = TOUR_OPTIONS[r.value];
			return { optionKey: r.value, label: opt.label, pricePerPerson: opt.price, remainingAtSelection: currentRemaining };
		})(),
        total: lastTotal.toFixed(2)
	};
    console.log('Booking payload', payload);
    try {
        alert(`Booking successfully!\nDate: ${payload.date}\nTime: ${payload.time}\nTotal: €${lastTotal.toFixed(2)}`);
    } catch (e) {
        // no-op in environments without alert
    }
    const successEl = document.getElementById('success-message');
    if (successEl){
        successEl.style.display = '';
        successEl.textContent = 'Successfully';
        successEl.setAttribute('role','status');
    }
    document.querySelector('.final-summary')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
});

// Init
buildCalendar();
normalizeTicketRows();
attachQtyHandlers();
updateTotals();
updateTourPriceNote();
tourOptionRadios().forEach(r=> r.addEventListener('change', ()=>{ updateTourPriceNote(); refreshTourRemainingUI(); updateTotals(); }));

// Navigate to success page with confirmation details
bookBtn.addEventListener('click', ()=>{
    // Build modal data
    const dateStr = selectedDate ? `${selectedDate.year}-${pad(selectedDate.month + 1)}-${pad(selectedDate.day)}` : '';
    const timeStr = selectedTime || '';
    const lines = [];
    for (const key of ['full','senior','student','discount','child']){
        const qty = parseInt(qtyInputs[key].value||'0',10);
        if (!qty) continue;
        const price = PRICES[key];
        lines.push({ label: TICKET_LABELS[key], qty, total: +(qty*price).toFixed(2), free: price===0 });
    }
    for (const optKey of Object.keys(TOUR_OPTIONS)){
        const qtyKey = `tour_${optKey}`;
        const qty = parseInt((qtyInputs[qtyKey]?.value)||'0',10);
        if (!qty) continue;
        const opt = TOUR_OPTIONS[optKey];
        lines.push({ label: `Guided tour — ${opt.label}`, qty, total: +(qty*opt.price).toFixed(2), free: false });
    }
    const getAudioLabel = (k)=> (k==='ag9'?'Audio Guide': k==='ag4'?'Audio Guide Group': k==='ag6'?'Audio Guide (Single)': k==='ag8'?'Audio Guide "Take 2"': k==='ag3'?'Audio Guide (Annual pass)': (AUDIO_LABELS && AUDIO_LABELS[k])||'Audio Guide');
    for (const ag of ['ag6','ag8','ag9','ag4','ag3']){
        const qty = parseInt(qtyInputs[ag].value||'0',10);
        if (!qty) continue;
        const price = AUDIO_GUIDE_PRICES[ag];
        lines.push({ label: getAudioLabel(ag), qty, total: +(qty*price).toFixed(2), free: price===0 });
    }
    const modal = document.getElementById('book-modal');
    if (!modal) return; // modal removed (reverted)
    const ml = document.getElementById('modal-lines');
    document.getElementById('modal-date').textContent = dateStr || '—';
    document.getElementById('modal-time').textContent = timeStr || '—';
    document.getElementById('modal-total').textContent = `€${lastTotal.toFixed(2)}`;
    ml.innerHTML = lines.map(li=> `<div class="item"><span class="label">${li.label} (${li.qty})</span><span class="value">${li.free ? 'Free' : ('€'+li.total.toFixed(2))}</span></div>`).join('');
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');
});

// Close modal handlers
document.getElementById('modal-close')?.addEventListener('click', ()=>{
    const modal = document.getElementById('book-modal');
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');
});
document.getElementById('book-modal')?.addEventListener('click', (e)=>{
    if (e.target.id === 'book-modal'){
        const modal = document.getElementById('book-modal');
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden','true');
    }
});
document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape'){
        const modal = document.getElementById('book-modal');
        if (modal && modal.style.display !== 'none'){
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden','true');
        }
    }
});
// Month navigation (no page jump)
if (calPrev) calPrev.addEventListener('click', ()=>{
    viewMonth -= 1;
    if (viewMonth < 0) { viewMonth = 11; viewYear -= 1; }
    selectedDate = null; selectedTime = null; pillDateText.textContent = 'Select'; pillTimeText.textContent = 'Select'; currentRemaining = null;
    buildCalendar(); enableOrDisableBook(); updateTourPriceNote();
});
if (calNext) calNext.addEventListener('click', ()=>{
    viewMonth += 1;
    if (viewMonth > 11) { viewMonth = 0; viewYear += 1; }
    selectedDate = null; selectedTime = null; pillDateText.textContent = 'Select'; pillTimeText.textContent = 'Select'; currentRemaining = null;
    buildCalendar(); enableOrDisableBook(); updateTourPriceNote();
});
</script>
</body>
</html>
